{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}
{% endblock %}

{% block scripts %}
<script>
    window.onload = function () {
        
        //import variables 
        var screenout = {{ screenout }}; //screenout boolean
        var quota= {{ quota }}; //quota boolean
        var label = {{ participant_label }}; //m or tic number
            
            
        // for the purpose of this seminar we have html files instead of links
        var url_screenout = "/static/ScreenoutLink.html";
        var url_quota = "/static/QuotaFullLink.html";
            
        //build urls 
        //var url_screenout = "https://mingle.respondi.com/s/1608318/ospe.php3?c_0002=0&return_tic=" + label;
        //c_002 = 0
            
        //var url_quota = "https://mingle.respondi.com/s/1608318/ospe.php3?c_0002=2&return_tic=" + label; 
        //c_002 = 2
            
        if (screenout==1) {window.location.replace(url_screenout);}
        if (quota==1) {window.location.replace(url_quota);}
        }
</script>

<script>
    // Gender popout function
    function genderPopout() {
        var genderOther = document.getElementById('genderOther');
        var otherDiv = document.getElementById('otherDiv');
        var timestampField = document.getElementById('time_gender_popout');
        
        if (genderOther.checked) {
            otherDiv.style.display = "block";
            timestampField.value = getCurrentTimestamp();
        } else {
            otherDiv.style.display = "none";
        }
    }

    // Travel popout function
    function travelPopout() {
        var travelYes = document.getElementById('travelYes');
        var divYes = document.getElementById('divYes');
        var timestampField = document.getElementById('time_travel_popout');
        
        if (travelYes.checked) {
            divYes.style.display = "block";
            timestampField.value = getCurrentTimestamp();
        } else {
            divYes.style.display = "none";
        }
    }

    // Set initial timestamp when page loads
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('time_page_load').value = getCurrentTimestamp();
    });
</script>

{% endblock %}

{% block content %}
<br>
<h2> General Questions </h2>
<hr>
<p>First, we'd like to ask some general questions.</p>
<hr>

<!-- persist-raw script input -->
<script src="{% static 'persist-raw.js' %}"></script>

<!-- Age question -->
{{ formfield "age_question" }}

<!-- Hidden field to record gender popout timestamp -->
<input id="time_gender_popout" type="hidden" name="time_gender_popout" />
{{ formfield_errors 'time_gender_popout' }}

<!-- Gender question -->
<br>
<div>
    <b>What is your gender?</b>
    <div><input type="radio" name="gender_question" value="1" class="persist" onclick="genderPopout()" /> Female</div>
    <div><input type="radio" name="gender_question" value="2" class="persist" onclick="genderPopout()" /> Male</div>
    <div><input type="radio" name="gender_question" value="3" class="persist" onclick="genderPopout()" /> Non-binary</div>
    <div><input type="radio" name="gender_question" value="4" class="persist" onclick="genderPopout()" /> Agender</div>
    <div><input id="genderOther" type="radio" name="gender_question" value="5" class="persist" onclick="genderPopout()" /> Other</div>
    <div><input type="radio" name="gender_question" value="6" class="persist" onclick="genderPopout()" /> Prefer not to say</div>
</div>

<!-- Gender "Other" popout -->
<div id="otherDiv" style="display: none">
    {{ formfield 'gender_popout' }}
</div>

<!-- Hidden field to record travel popout timestamp -->
<input id="time_travel_popout" type="hidden" name="time_travel_popout" />
{{ formfield_errors 'time_travel_popout' }}

<!-- Travel question -->
<br>
<div>
    <b>Have you ever travelled before?</b>
    <div><input id="travelYes" type="radio" name="has_travelled" value=True class="persist" onclick="travelPopout()" /> Yes</div>
    <div><input id="travelNo" type="radio" name="has_travelled" value=False class="persist" onclick="travelPopout()" /> No</div>
</div>

<!-- Travel destination popout -->
<div id="divYes" style="display: none">
    {{ formfield 'travel_destination_popout' }}
</div>

<hr>
<button class="otree-btn-next btn btn-primary next-button otree-next-button">
    Next
</button>

{% endblock %}