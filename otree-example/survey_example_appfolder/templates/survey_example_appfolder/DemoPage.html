{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}
{% endblock %}

{% block scripts %}
<script>
    // Function to get current timestamp
    function getCurrentTimestamp() {
        return new Date().toISOString();
    }

    // Gender popout function
    function genderPopout() {
        var genderOther = document.getElementById('genderOther');
        var otherDiv = document.getElementById('otherDiv');
        var timestampField = document.getElementById('time_gender_popout');
        
        if (genderOther.checked) {
            otherDiv.style.display = "block";
            timestampField.value = getCurrentTimestamp();
        } else {
            otherDiv.style.display = "none";
        }
    }

    // Travel popout function
    function travelPopout() {
        var travelYes = document.getElementById('travelYes');
        var divYes = document.getElementById('divYes');
        var timestampField = document.getElementById('time_travel_popout');
        
        if (travelYes.checked) {
            divYes.style.display = "block";
            timestampField.value = getCurrentTimestamp();
        } else {
            divYes.style.display = "none";
        }
    }

    // Set initial timestamp when page loads
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('time_page_load').value = getCurrentTimestamp();
    });
</script>
{% endblock %}

{% block content %}
<br>
<h2> General Questions </h2>
<hr>
<p>First, we'd like to ask some general questions.</p>
<hr>

<!-- Age question -->
{{ formfield "age_question" }}

<!-- Hidden field to record gender popout timestamp -->
<input id="time_gender_popout" type="hidden" name="time_gender_popout" />
{{ formfield_errors 'time_gender_popout' }}

<!-- Gender question -->
<br>
<div>
    <b>What is your gender?</b>
    <div><input type="radio" name="gender_question" value="1" onclick="genderPopout()" /> Female</div>
    <div><input type="radio" name="gender_question" value="2" onclick="genderPopout()" /> Male</div>
    <div><input type="radio" name="gender_question" value="3" onclick="genderPopout()" /> Non-binary</div>
    <div><input type="radio" name="gender_question" value="4" onclick="genderPopout()" /> Agender</div>
    <div><input id="genderOther" type="radio" name="gender_question" value="5" onclick="genderPopout()" /> Other</div>
    <div><input type="radio" name="gender_question" value="6" onclick="genderPopout()" /> Prefer not to say</div>
</div>

<!-- Gender "Other" popout -->
<div id="otherDiv" style="display: none">
    {{ formfield 'gender_popout' }}
</div>

<!-- Hidden field to record travel popout timestamp -->
<input id="time_travel_popout" type="hidden" name="time_travel_popout" />
{{ formfield_errors 'time_travel_popout' }}

<!-- Travel question -->
<br>
<div>
    <b>Have you ever travelled before?</b>
    <div><input id="travelYes" type="radio" name="has_travelled" value=True onclick="travelPopout()" /> Yes</div>
    <div><input id="travelNo" type="radio" name="has_travelled" value=False onclick="travelPopout()" /> No</div>
</div>

<!-- Travel destination popout -->
<div id="divYes" style="display: none">
    {{ formfield 'travel_destination_popout' }}
</div>

<hr>
<button class="otree-btn-next btn btn-primary next-button otree-next-button">
    Next
</button>

{% endblock %}